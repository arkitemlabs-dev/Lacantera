-- โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
-- VERIFICAR USUARIO CREADO
-- โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

USE PP;
GO

PRINT 'โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ';
PRINT '๐ VERIFICANDO USUARIO admin@lacantera.com';
PRINT 'โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ';
PRINT '';

DECLARE @Email VARCHAR(100) = 'admin@lacantera.com';

-- โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
-- 1. BUSCAR EN WebUsuario
-- โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

PRINT '๐ Buscando en WebUsuario:';
PRINT 'โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ';

IF EXISTS (SELECT 1 FROM WebUsuario WHERE eMail = @Email)
BEGIN
    PRINT 'โ Usuario encontrado en WebUsuario';
    PRINT '';

    SELECT
        UsuarioWeb AS [Cรณdigo],
        Nombre,
        eMail AS Email,
        Contrasena AS [Hash Password],
        LEN(Contrasena) AS [Longitud Hash],
        Rol,
        Estatus,
        FORMAT(Alta, 'dd/MM/yyyy HH:mm', 'es-MX') AS [Fecha Alta]
    FROM WebUsuario
    WHERE eMail = @Email;

    PRINT '';

    -- Verificar hash especรญfico
    DECLARE @HashEsperado VARCHAR(255) = '$2a$10$N9qo8uLOickgx2ZMRZoMyeIjZAgcfl7p92ldGxad68LJZdL17lhkO';
    DECLARE @HashActual VARCHAR(255);

    SELECT @HashActual = Contrasena FROM WebUsuario WHERE eMail = @Email;

    PRINT '๐ Verificaciรณn de Hash:';
    PRINT 'โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ';

    IF @HashActual = @HashEsperado
    BEGIN
        PRINT 'โ El hash es CORRECTO (coincide exactamente)';
        PRINT '   Contraseรฑa: admin123456';
    END
    ELSE
    BEGIN
        PRINT 'โ El hash NO coincide';
        PRINT '';
        PRINT 'Hash esperado:';
        PRINT @HashEsperado;
        PRINT '';
        PRINT 'Hash actual:';
        PRINT @HashActual;
    END

    PRINT '';

    -- Verificar estatus
    DECLARE @Estatus VARCHAR(20);
    SELECT @Estatus = Estatus FROM WebUsuario WHERE eMail = @Email;

    PRINT '๐ Verificaciรณn de Estatus:';
    PRINT 'โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ';

    IF @Estatus = 'ACTIVO'
        PRINT 'โ Estatus es ACTIVO (correcto)';
    ELSE
        PRINT CONCAT('โ Estatus es "', @Estatus, '" (debe ser "ACTIVO")');

    PRINT '';

    -- Verificar rol
    DECLARE @Rol VARCHAR(50);
    SELECT @Rol = Rol FROM WebUsuario WHERE eMail = @Email;

    PRINT '๐ Verificaciรณn de Rol:';
    PRINT 'โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ';

    IF @Rol IN ('super-admin', 'admin')
        PRINT CONCAT('โ Rol es "', @Rol, '" (correcto)');
    ELSE IF @Rol IS NULL
        PRINT 'โ Rol es NULL';
    ELSE
        PRINT CONCAT('โ๏ธ  Rol es "', @Rol, '"');

    PRINT '';
END
ELSE
BEGIN
    PRINT 'โ Usuario NO encontrado en WebUsuario';
    PRINT '';
END

PRINT 'โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ';
PRINT 'โ VERIFICACIรN COMPLETADA';
PRINT 'โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ';
